@page "/statefulsets"

@using Braveior.KubeAssist.Services
@using Braveior.KubeAssist.Services.Models
@inject KubernetesService KubernetesService
@inject NavigationManager NavigationManager

<MudTable Dense="true" Items="@StatefulSetList" Hover="true" Breakpoint="Breakpoint.Sm">
    <HeaderContent>
        <MudTh></MudTh>
        <MudTh>Name</MudTh>
        <MudTh>Namespace</MudTh>
        <MudTh>No Of Replicas</MudTh>
        <MudTh>Current Replicas</MudTh>
        <MudTh>Ready Replicas</MudTh>
        <MudTh>Updated Replicas</MudTh>
        <MudTh>Created Date</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd><MudButton Variant="Variant.Outlined" Size="MudBlazor.Size.Small" OnClick="@(() => NavigateStatefulSetDetails(context.Metadata.Name))">Statefulset Details</MudButton></MudTd>
        <MudTd DataLabel="Name">@context.Metadata.Name</MudTd>
        <MudTd DataLabel="Namespace">@context.Metadata.NamespaceProperty</MudTd>
        <MudTd DataLabel="NoOfReplicas">@context.Status.Replicas</MudTd>
        <MudTd DataLabel="CurrentReplicas">@context.Status.CurrentReplicas</MudTd>
        <MudTd DataLabel="ReadyReplicas">@context.Status.ReadyReplicas</MudTd>
        <MudTd DataLabel="UpdatedReplicas">@context.Status.UpdatedReplicas</MudTd>
        <MudTd DataLabel="CreatedDate">@context.Metadata.CreationTimestamp</MudTd>
    </RowTemplate>
</MudTable>


@code
{
    protected override void OnInitialized()
    {
        LoadStatefulSets();
        base.OnInitialized();
    }

    private async Task LoadStatefulSets()
    {
        var statefulsets = await KubernetesService.GetStatefulSets("default");
        if (statefulsets.Items != null)
        {
            StatefulSetList = statefulsets.Items.ToList();
        }
        StateHasChanged();
        //if (KubeStateState.Value.KubeState != null)
        //{

        //    StatefulSetList = KubeStateState.Value.KubeState.StatefulSets;
        //}
    }
    private static List<V1StatefulSet> StatefulSetList { get; set; }

    private void NavigateStatefulSetDetails(string name)
    {
        NavigationManager.NavigateTo($"/statefulsetdetail/{name}");
    }
}
